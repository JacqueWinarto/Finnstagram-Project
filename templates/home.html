<html>
<head>
	<!-- META -- >
	<title>Finnstagram</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<link rel="shortcut icon" href=""/>
	<!-- FONTS -->
	<link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Hind:400,700' rel='stylesheet' type='text/css'>

	<!-- STYLE -->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<link rel="stylesheet" href="{{ url_for('static',filename='style/main.css') }}">


	<!-- SCRIPTS -->
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</head>

<body>
	<!-- NAV BAR -->
	<nav class="navbar navbar-expand-sm fixed-top" id="header">
		<div class="container-fluid">
		<!-- Links -->
		<div class="navbar-header">
			<a class="navbar-brand" href="/">Finnstagram</a>
		</div>
		<ul class="nav navbar-nav">
			<li class="nav-item">
				<a href="/user" class="nav-link"> Find User</a>
			</li>
			<li class="nav-item">
				<a href="/groups" class="nav-link">Groups</a>
			</li>
			<li class="nav-item">
				<a href="/tags" class="nav-link">Manage Tags</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/follows">Manage Follows</a>
			</li>
			<li class="nav-item">
					<a class="nav-link" href="/logout">Logout</a>
			</li>
		</ul>
	</div>
	</nav>
	<!-- Nav Bar -->
	<!-- PAGE -->
	<div class="container" style="margin-top:100px;">
		{% if error == 'False' %}
			<div class="alert alert-success">
				<strong>Success!</strong>
			</div>
    {% elif error %}
			<div class="alert alert-danger">
				<strong>Error:</strong> {{error}}
			</div>
    {% endif %}
		<div class="row">
			<span class="col-md-3" id="sidebar">
				<form action="/post" method="POST" id="postForm">
					<h4>Welcome {{username}}</h4><br/>
					<input type="text" name = "filepath" placeholder="link" required/> </br>
					<textarea name = "caption" placeholder="caption" required/></textarea></br>
					Visible to all?
					<input type="checkbox" id="check" onClick="showGroups()" name ="visible" value ="true"> <br/>
					<!-- get the options from CloseFriendsGroup -->
					<div id="groups">
						Share with groups? <br/>
						{% for group in groups %}
						<!-- loop index used in loop, value is groups name -->
						<input type="checkbox" name="{{loop.index}}" value={{group.groupName}}>{{group.groupName}}<br/>
						{% endfor %}
					</div>
					<input type="submit" value = Post />
				</form>
			</span>
			<span class="col-md-6" id="posts">
				<!-- START POSTS LOOP -->
				{% for line in posts %}
				<!-- DEFINE OUTER LOOP INDEXING -->
				{% set outer_loop = loop %}
				<!-- EACH POST HAS AN INDEX ID SO WE CAN SCROLL TO IT-->
				<span class="post" id = "{{outer_loop.index}}">
					<!-- TOP INFO -->
					<div class="post-info">
						<b style="float:left">{{line.photoOwner}}</b>
						{{line.photoID}} at {{line.Timestamp}}
					</div>
					<!-- IMAGE -->
					<img src="{{line.filePath }}" width ="100%"/>
					<!-- cAPTION-->
					<div class="caption">
						<b>{{line.photoOwner}}</b>
						{{line.caption}}
					</div>
					<!-- BOTTOM INFO -->
					<div class="bottom-info">
						<!-- VARIABLE USED IF POST ALREADY LIKED -->
						{% set ns = namespace(found=false) %}
						<!-- GO THROUGH LIKED POSTS -->
						{% for post in likes if line.photoID == post.photoID %}
						{% set ns.found = true %}
						<form action="/unlike" method="POST" class="like">
							<button type="submit" name="like_btn" value = "{{line.photoID}},{{outer_loop.index}}"
							<i class="fas fa-heart clickable" data-toggle="tooltip" title="Unlike"></i>
							</button>
						</form>
					{% endfor %}
					<!-- POST NOT LIKED, SHOW LIKE FORM -->
					{% if ns.found == false  %}
					<form action="/like" method="POST" class="like">
						<button type="submit" name="like_btn" value = "{{line.photoID}},{{outer_loop.index}}"
						<i class="far fa-heart clickable" data-toggle="tooltip" title="Like"></i>
						</button>
					</form>
				{% endif %}
				<!-- END LIKES STUFF -->
				<!-- START TAGS STUFF-->
				<!-- COLLAPSABLE BUTTON FOR ADDING TAGS -->
				<a href="#add{{outer_loop.index}}" data-toggle="collapse" title="Add Tag"><i class="fas fa-tags"></i></a>&nbsp
				<!-- ONLY SHOW TAGS IF THEY EXIST-->
				{% if tagged %}
				<span class="tags">
					{% for tag in tagged if tag.photoID == line.photoID %}

					{{tag.fname}} {{tag.lname}}
					<!-- ADD COMMA IF THERE'S ANOTHER TAG AFTER-->
					{% if loop.nextitem is defined %},{% endif %}
					{% endfor %}
				</span>
				{% endif %}
				<div id="add{{outer_loop.index}}" class="add collapse">
					<form action="/addTag" method="POST">
						<!-- using an invisible checkbox so that the query can get the photoID -->
						<input type="checkbox"  style="display:none" name="photo_id" value ={{line.photoID}} checked/>
						<div class="input-group">
						<input type="text" name="added_user" class="form-control" placeholder="Search For User">
						<div class="input-group-append">
							<button class="btn btn-secondary" type="submit">
								Add Tag
							</button>
						</div>
						</div>
					</form>
				</div>
				<!-- show everyone who has liked the photo -->
				<br>
				{% if liked %}
				<span class="liked">
					{% for like in liked if like.photoID == line.photoID %}
					<strong style="color:#330033;">{{like.username}}</strong>
					{% if loop.nextitem is defined %},{% endif %}
					{% endfor %}
					<h7>liked this</h7>
				</span>
				{% endif %}

				<!-- START COMMENT STUFF -->
					<!-- see all comments per PhotoID -->
					{% if comments %}
					<br><h7 style="color:#606060;">Comments</h7><br>
					<span class = "comments">
						{% for comment in comments if comment.photoID == line.photoID %}
						<strong style="color:#330033;">{{comment.time}} {{comment.username}} </strong> {{comment.commentText}}
						<!-- go through all the comments -->
						{% if loop.nextitem is defined %}<p>{% endif %}
						{% endfor %}
					</span>
					{% endif %}
					<!-- add a comment -->
					<form action="/comment" method="POST">
						<textarea name = "comment" placeholder="comment" required/></textarea>
						<input type="checkbox"  style="display:none" name="photo_id" value ={{line.photoID}} checked/>
						<input type="submit" value = "Publish Comment"/>
					</form>
					</div>
			<!-- END BOTTOM INFO -->
		</span>
		<!-- END POST -->
		{% endfor %}
		<!-- END POSTS LOOP-->
	</span>
	<!-- END COLUMN -->
	<span class="col-md-3"></span>
</div>
<!-- END ROW-->
</div>
</body>

<!-- Function for showing the groups when visible to all isn't clicked-->
<script>
function showGroups() {
	// Get the checkbox
	var checkBox = document.getElementById("check");
	// Get the output text
	var text = document.getElementById("groups");

	// If the checkbox is not checked, display the group options
	if (checkBox.checked == false){
		text.style.display = "block";
	} else {
		text.style.display = "none";
	}
}
</script>
</html>
